<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Assessed Variant Details</title>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #042c5c;
      color: black;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: white;
    }
    .entry-box {
      background-color: white;
      max-width: 800px;
      margin: 30px auto;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: left;
    }
    .entry-box h2 {
      color: #de3b38;
      margin-top: 0;
      font-size: 22px;
    }
    .entry-box ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }
    .entry-box li {
      margin-bottom: 12px;
    }
    .assessment-box {
      background-color: #f9f9f9;
      border-left: 6px solid #de3b38;
      padding: 20px;
      margin-top: 25px;
      border-radius: 6px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
    }
    .assessment-box h3 {
      color: #042c5c;
      margin-top: 0;
    }
    .back-button {
      display: block;
      text-align: center;
      margin: 30px auto;
      background-color: #de3b38;
      color: white;
      padding: 10px 20px;
      text-decoration: none;
      border-radius: 4px;
      width: fit-content;
      font-size: 14px;
      font-weight: bold;
    }
    .back-button:hover {
      background-color: #b9312c;
    }
    .floating-main-button {
      position: fixed;
      top: 20px;
      right: 10px;
      background-color: #de3b38;
      color: white;
      padding: 6px 8px;
      border-radius: 6px;
      font-weight: bold;
      text-decoration: none;
      font-size: 12px;
      width: 60px;
      text-align: center;
      line-height: 1.2;
      z-index: 1000;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.2);
    }
    .floating-main-button:hover {
      background-color: #b9312c;
    }
  </style>

  <script>
    async function loadEntry() {
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get("id");

      try {
        const response = await fetch("https://gene-registry.onrender.com/api/data?table=assessed_variants");
        if (!response.ok) throw new Error("Network error");

        const data = await response.json();
        const entry = data.find(item => String(item["ID"]) === id);

        if (!entry) {
          document.getElementById("variant-details").innerHTML = "<li>Entry not found.</li>";
          return;
        }

        // Fields except Assessment
        const variantFields = [
          "Gene",
          "RefSeq Transcript",
          "Coding DNA change (c.)",
          "Predicted protein change (p.)",
          "Confirmed protein or RNA change (for splicing variants)",
          "ClinVar",
          "Pathomechanism",
          "Inheritance",
          "Splicing effect?",
          "Variant publication",
          "Therapeutic Modality",
          "Approach",
          "Eligibility",
          "Publication",
          "Date assessment"
        ];

        const variantList = document.getElementById("variant-details");
        variantList.innerHTML = "";

       variantFields.forEach((key) => {
        const raw = entry[key];

        // Skip if null/undefined
        if (raw === undefined || raw === null) return;

        // Convert everything to string safely
        const value = String(raw).trim();
        if (value === "") return;

        let displayValue = value;

        // Make URLs clickable (ClinVar / Publication etc.)
        if (/^https?:\/\//i.test(value)) {
        displayValue = `<a href="${value}" target="_blank" rel="noopener noreferrer">${value}</a>`;
    }

  variantList.insertAdjacentHTML(
    "beforeend",
    `<li><strong>${key}:</strong> ${displayValue}</li>`
  );
});

        // Show Assessment separately
        const assessmentBox = document.getElementById("assessment");
        if (entry["Assessment text"] && entry["Assessment text"].trim() !== "") {
          assessmentBox.innerHTML = `
            <div class="assessment-box">
              <h3>Assessment</h3>
              <p>${entry["Assessment text"]}</p>
            </div>
          `;
        } else {
          assessmentBox.innerHTML = "";
        }

      } catch (error) {
        console.error("Error loading entry:", error);
        document.getElementById("variant-details").innerHTML = "<li>Error loading entry details.</li>";
      }
    }
  </script>
</head>
<body onload="loadEntry()">
  <header style="display: flex; align-items: center; padding: 10px 20px;">
    <img src="N1C_logo.jpg" alt="N1C Logo" style="height: 50px; border-radius: 50%;" />
  </header>

  <h1>Assessed Variant Details</h1>

  <a href="https://generegistry.n1collaborative.org/" class="floating-main-button">
    Main<br>Registry
  </a>

  <div class="entry-box">
    <h2>Variant Information</h2>
    <ul id="variant-details"></ul>
    <div id="assessment"></div>
  </div>

  <a class="back-button" href="assessed_variants.html">Back to Assessed Variants</a>
</body>
</html>

