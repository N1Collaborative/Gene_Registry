<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>N1C Assessed Variants</title>

  <meta name="description" content="The N1C Assessed Variants Registry is a curated database of variant-level therapeutic assessments." />

  <meta property="og:title" content="N1C Assessed Variants" />
  <meta property="og:description" content="Explore assessed variants and their therapeutic eligibility, curated by the N=1 Collaborative." />
  <meta property="og:image" content="https://n1collaborative.github.io/Gene_Registry/N1C_logo.jpg" />
  <meta property="og:url" content="https://n1collaborative.github.io/Gene_Registry/variants.html" />
  <meta property="og:type" content="website" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #042c5c;
      color: white;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    
    h1 {
      text-align: center;
      color: white;
      font-size: 44px;
      font-weight: bold;
      margin: 10px 0 20px 0;
    }
    
    .search-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px auto;
    }
    
    .search-wrapper input[type="text"] {
      height: 42px;
      padding: 0 12px;
      font-size: 16px;
      border: none;
      border-top-left-radius: 4px;
      border-bottom-left-radius: 4px;
      outline: none;
    }
    
    .search-button {
      height: 42px;
      padding: 0 16px;
      font-size: 16px;
      background-color: #de3b38;
      color: white;
      border: none;
      border-top-right-radius: 4px;
      border-bottom-right-radius: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    
    table {
      width: 90%;
      margin: 20px auto;
      border-collapse: collapse;
      background: white;
      color: black;
      font-size: 14px;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
    }
    
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: center;
    }
    
    th {
      background-color: #de3b38;
      color: white;
      font-size: 16px;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    
    tr:nth-child(even) { background: #f9f9f9; }
    tr:hover { background: #c7c4bc; cursor: pointer; }
    button {
      background-color: #de3b38;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
    }
    
    button:hover { background-color: #b9312c; }
    .scroll-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #de3b38;
      color: white;
      border: none;
      padding: 10px 14px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
    }
    
    .scroll-top:hover { background-color: #b9312c; }


    .floating-logo {
  position: fixed;
  top: 10px;
  left: 20px;
  z-index: 1000;
}

.floating-main-button {
  position: fixed;
  top: 20px;
  right: 10px;
  background-color: #de3b38;
  color: white;
  padding: 6px 8px;
  border-radius: 6px;
  font-weight: bold;
  text-decoration: none;
  font-size: 12px;
  width: 60px;
  text-align: center;
  line-height: 1.2;
  z-index: 1000;
  box-shadow: 1px 1px 5px rgba(0,0,0,0.2); /* optional: subtle shadow */
}


.floating-main-button:hover {
  background-color: #b9312c;
}


    
  </style>

  <script>
  let tableData = [];

  async function loadTable(retry = false) {
    try {
      document.getElementById("loading").style.display = "block";
      const response = await fetch("https://gene-registry.onrender.com/api/data?table=assessed_variants");
      if (!response.ok) throw new Error("Network response not ok");
      tableData = await response.json();
      displayTable(tableData);
    } catch (error) {
      console.error("Error loading data:", error);
      if (!retry) setTimeout(() => loadTable(true), 3000);
      else document.getElementById("data-table").innerHTML = "<p>Error loading data.</p>";
    } finally {
      document.getElementById("loading").style.display = "none";
    }
  }

  function displayTable(data) {
    let table = document.getElementById("data-table");
    table.innerHTML = "";

    if (data.length === 0) {
      table.innerHTML = "<p>No data found.</p>";
      return;
    }

    // ✅ Sort alphabetically by Gene, then by c. notation
    data.sort((a, b) => {
      const geneA = (a["Gene"] || "").toLowerCase();
      const geneB = (b["Gene"] || "").toLowerCase();
      if (geneA < geneB) return -1;
      if (geneA > geneB) return 1;

      const cA = a["Coding DNA change (c.)"] || "";
      const cB = b["Coding DNA change (c.)"] || "";
      return cA.localeCompare(cB, undefined, { numeric: true });
    });

    const headers = [
      "Gene",
      "RefSeq Transcript",
      "Coding DNA change (c.)",
      "Predicted protein change (p.)",
      "Therapeutic Modality",
      "Approach",
      "Eligibility"
    ];

    let headerRow = "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
    let bodyRows = data.map(item => {
      const row = headers.map(h => `<td>${item[h] ?? "N/A"}</td>`).join("");
      return `<tr onclick="viewEntry('${item["ID"]}')" style="cursor:pointer;">${row}</tr>`;
    }).join("");

    table.innerHTML = headerRow + bodyRows;
  }

  function searchTable() {
    let query = document.getElementById("search").value.toLowerCase();
    let filteredData = tableData.filter(row =>
      Object.values(row).some(value => String(value).toLowerCase().includes(query))
    );
    displayTable(filteredData);
  }

  function viewEntry(id) {
    window.location.href = `variant_entry.html?id=${id}`;
  }
</script>

</head>
  
<body onload="loadTable()">
  <a href="https://www.n1collaborative.org/" target="_blank" class="floating-logo">
      <img src="N1C_logo.jpg" alt="N1C Logo" style="height: 50px; border-radius: 50%;">
  </a>
  
  <a href="https://generegistry.n1collaborative.org/" class="floating-main-button">
    Main<br>Registry
  </a>

  <h1>N1C Assessed Variants</h1>

  <div style="max-width: 800px; margin: 40px auto 20px; padding: 20px; background-color: white; border-radius: 8px; text-align: center;">
      <h2 style="color: #D8443D;">Site currently under construction</h2>
      <p style="font-size: 16px; color: #333;">
       
      </p>
    </div>

  <div class="search-wrapper">
    <input type="text" id="search" placeholder="Search...">
    <button class="search-button" onclick="searchTable()">Search</button>
  </div>

  <p id="loading">Loading table...</p>
  <table id="data-table"></table>

  <button onclick="window.scrollTo({top: 0, behavior: 'smooth'});" class="scroll-top">↑</button>

  <footer>
    <p>© N=1 Collaborative</p>
    <p id="last-updated">Last updated: ...</p>
  </footer>

  <script>
    document.getElementById("last-updated").textContent = "Last updated: " + new Date().toLocaleString();
  </script>
</body>
</html>
