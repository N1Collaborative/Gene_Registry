<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N1C Gene Registry</title>

    <!-- General Description -->
    <meta name="description" content="The N1C Gene Registry is a searchable database of therapeutic approaches for rare genetic variants, curated by the N=1 Collaborative." />

    <!-- Social Sharing: Open Graph (used by Facebook, LinkedIn, etc.) -->
    <meta property="og:title" content="N1C Gene Registry" />
    <meta property="og:description" content="Explore therapeutic projects for rare genetic conditions. Curated by the N=1 Collaborative." />
    <meta property="og:image" content="https://n1collaborative.github.io/Gene_Registry/N1C_logo.jpg" />
    <meta property="og:url" content="https://n1collaborative.github.io/Gene_Registry/" />
    <meta property="og:type" content="website" />


<style>
     
  body {
    font-family: Arial, sans-serif;
    background-color: #042c5c;
    color: white;
    text-align: center;
    margin: 0;
    padding: 20px;
  }

  h1 {
    text-align: center;
    color: white;
    font-size: 48px;
    font-weight: bold;
    margin: 5px 0 10px 0;
  }

  .search-wrapper {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px auto;
  }

  .search-wrapper input[type="text"] {
    height: 42px;
    padding: 0 12px;
    font-size: 16px;
    border: none;
    border-top-left-radius: 4px;
    border-bottom-left-radius: 4px;
    outline: none;
    box-sizing: border-box;
  }

  .search-button {
    height: 42px;
    padding: 0 16px;
    font-size: 16px;
    background-color: #de3b38;
    color: white;
    border: none;
    border-top-right-radius: 4px;
    border-bottom-right-radius: 4px;
    font-weight: bold;
    box-sizing: border-box;
  }

  table, th, td {
      font-size: 12px;
      border: 1px solid #ddd;
      text-align: center;
      padding: 6px 8px;
      word-wrap: break-word;
      white-space: normal;
    }

  table {
    background-color: white;
    color: black;
    border-collapse: collapse;
    width: 100%;
  }

  th {
    background-color: #de3b38;
    color: white;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 1;
    font-size: 18px;
  }

  td {
    background-color: white;
    color: black;
  }

  tr:nth-child(even) {
    background-color: #f9f9f9;
  }

  tr:hover {
    background-color: #f1f1f1;
  }

  details table tr:hover {
    background: inherit !important;
    cursor: default !important;
  }

  button,
  .submit-button {
    background-color: #de3b38;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    text-decoration: none;
  }

  button:hover,
  .submit-button:hover {
    background-color: #b9312c;
  }

  .scroll-top {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #de3b38;
    color: white;
    border: none;
    padding: 10px 14px;
    border-radius: 50%;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
    z-index: 999;
  }

  .scroll-top:hover {
    background-color: #b9312c;
  }

  footer {
    margin-top: 40px;
    text-align: center;
    color: white;
    font-size: 0.9em;
  }

  details summary {
    font-size: 28px;
    font-weight: bold;
    color: #de3b38;
    background-color: white;
    padding: 10px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin: 10px auto;
    border: 1px solid #ccc;
    list-style: none;
    text-align: center; /* ✅ Center the letter */
  }

  details summary::-webkit-details-marker {
    display: none;
  }

  details summary:hover {
    background-color: #fde4e2;
    color: #b9312c;
    cursor: pointer;
  }

  details table {
    table-layout: fixed;
    width: 100%;
    border-collapse: collapse;
  }

  details th, details td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: center;
    word-wrap: break-word;
  }

  /* Column widths for marketed drug table */
  th:nth-child(1), td:nth-child(1) { width: 120px; }
  th:nth-child(2), td:nth-child(2) { width: 180px; }
  th:nth-child(3), td:nth-child(3) { width: 80px; }
  th:nth-child(4), td:nth-child(4) { width: 100px; }
  th:nth-child(5), td:nth-child(5) { width: 160px; }
  th:nth-child(6), td:nth-child(6) { width: 120px; }
  th:nth-child(7), td:nth-child(7) { width: 100px; }

  .registry-buttons {
    display: flex;
    justify-content: center;
    gap: 30px;
    margin: 30px auto;
    flex-wrap: wrap;
  }

  .registry-button {
    background-color: #de3b38;
    color: white;
    font-weight: bold;
    font-size: 18px;
    padding: 16px 32px;
    border-radius: 8px;
    text-decoration: none;
    width: 280px;
    text-align: center;
    transition: background-color 0.3s, transform 0.2s;
  }

  .registry-button:hover {
    background-color: #b9312c;
    transform: scale(1.05);
  }

  .top-right-button {
    position: absolute;
    top: 20px;
    right: 20px;
  }

  .back-to-main {
    background-color: #de3b38;
    color: white;
    font-weight: bold;
    padding: 10px 18px;
    border-radius: 8px;
    text-decoration: none;
    font-size: 16px;
    transition: background-color 0.3s;
  }

  .back-to-main:hover {
    background-color: #b9312c;
  }

  .main-header {
    position: sticky;
    top: 0;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: rgba(4, 44, 92, 0.8);
    padding: 8px 16px;
    backdrop-filter: blur(6px);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    border-bottom: 1px solid #ccc;
  }

  .logo {
    height: 50px;
    border-radius: 50%;
  }

  .floating-logo {
    position: fixed;
    top: 10px;
    left: 20px;
    z-index: 1000;
  }

  .floating-main-button {
    position: fixed;
    top: 20px;
    right: 10px;
    background-color: #de3b38;
    color: white;
    padding: 6px 8px;
    border-radius: 6px;
    font-weight: bold;
    text-decoration: none;
    font-size: 12px;
    width: 60px;
    text-align: center;
    line-height: 1.2;
    z-index: 1000;
    box-shadow: 1px 1px 5px rgba(0,0,0,0.2);
  }

  .floating-main-button:hover {
    background-color: #b9312c;
  }

#filters {
  margin: 20px auto;
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  justify-content: center;
}

#filters select {
  padding: 6px 12px;
  font-size: 14px;
  border-radius: 4px;
}


    
</style>




    
<script>
        
  let tableData = []; // Store fetched data globally

  async function loadTable(retry = false) {
    try {
      document.getElementById("loading").style.display = "block";
      const response = await fetch("https://gene-registry.onrender.com/api/data?table=marketed_drugs");
      if (!response.ok) throw new Error("Network response was not ok");

      tableData = await response.json();
      displayTable(tableData);
    } catch (error) {
      console.error("Error loading data:", error);

      if (!retry) {
        console.log("Retrying in 3 seconds...");
        setTimeout(() => loadTable(true), 3000);
        return;
      }

      document.getElementById("data-table").innerHTML = "<p>Error loading data.</p>";
    } finally {
      document.getElementById("loading").style.display = "none";
    }
  }






  let currentSort = { column: null, ascending: true };

function displayTable(data) {
  let table = document.getElementById("data-table");
  table.innerHTML = "";

  if (data.length === 0) {
    table.innerHTML = "<p>No data found.</p>";
    return;
  }

  const headers = [
    "Marketed drug",
    "Condition/indication",
    "Gene",
    "Modality",
    "Mechanism",
    "Company",
    "DrugBank ID"
  ];

  // Header row with clickable sorting
  let headerRow = "<tr>";
  headers.forEach(header => {
    headerRow += `<th onclick="sortTable('${header}')">${header}</th>`;
  });
  headerRow += "</tr>";

  // Body rows
  let bodyRows = data.map(item => {
    return `<tr>${headers.map(h => `<td>${item[h] || "N/A"}</td>`).join("")}</tr>`;
  }).join("");

  table.innerHTML = headerRow + bodyRows;
}
function sortTable(column) {
  if (currentSort.column === column) {
    currentSort.ascending = !currentSort.ascending;
  } else {
    currentSort.column = column;
    currentSort.ascending = true;
  }

  tableData.sort((a, b) => {
    const valA = (a[column] || "").toLowerCase();
    const valB = (b[column] || "").toLowerCase();
    if (valA < valB) return currentSort.ascending ? -1 : 1;
    if (valA > valB) return currentSort.ascending ? 1 : -1;
    return 0;
  });

  displayTable(tableData);
}


  function expandAll(expand) {
    const sections = document.querySelectorAll("details");
    sections.forEach(section => {
      section.open = expand;
    });
  }
</script>

  
    
</head>
<body onload="loadTable()">
    <a href="https://www.n1collaborative.org/" target="_blank" class="floating-logo">
      <img src="N1C_logo.jpg" alt="N1C Logo" style="height: 50px; border-radius: 50%;">
    </a>
    
    <a href="https://generegistry.n1collaborative.org/" class="floating-main-button">
      Main<br>Registry
    </a>

    
    <h1 style="font-size: 36px; line-height: 1.2; margin-top: 80px;">
      N1C Gene Registry<br>Marketed Genetic Therapies
    </h1>

    <div style="max-width: 800px; margin: 40px auto 20px; padding: 20px; background-color: white; border-radius: 8px; text-align: center;">
      <h2 style="color: #D8443D;">Information missing?</h2>
      <p style="font-size: 16px; color: #333;">
        Are we missing a marketed drug or relevant information?
        Please reach out to generegistry@n1collaborative.org.  
      </p>
    </div>

     <div class="search-wrapper">
      <input type="text" id="search" placeholder="Search..." />
      <button class="search-button" onclick="searchTable()">Search</button>
    </div>

    <div style="text-align: center; margin-bottom: 20px;">
      <button class="submit-button" onclick="expandAll(true)">Expand All</button>
      <button class="submit-button" onclick="expandAll(false)">Collapse All</button>
    </div>

        

<p id="loading">Loading table...</p>

<div>
  <table id="data-table"></table>
</div>




    <button onclick="window.scrollTo({top: 0, behavior: 'smooth'});" class="scroll-top">↑ Top</button>

    <p style="color: white; font-size: 16px;">
      Looking to integrate or access our data? Visit the 
      <a href="api.html" style="color: #D8443D; font-weight: bold;">N1C API documentation</a>.
    </p>

    <footer style="text-align: center; margin-top: 40px; font-size: 0.9em; color: #777;">
      <p>© N=1 Collaborative</p>
      <p id="last-updated">Last updated: ...</p>
    </footer>

    <script>
        const now = new Date();
        document.getElementById("last-updated").textContent = "Last updated: " + now.toLocaleString();
    </script>
    
</body>
</html>
